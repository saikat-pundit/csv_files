name: Generate PDFs from CSV

on:
  workflow_dispatch:
    inputs:
      csv_url:
        description: 'CSV File URL'
        required: true
        default: 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTBuDewVgTDoc_zaWYQyaWKpBt0RwtFPhnBrpqr1v6Y5wfAmPpEYvTsaWd64bsHhH68iYNtLMSRpOQ0/pub?gid=113399134&single=true&output=csv'
        type: string
      start_row:
        description: 'Start Row Number (1-based)'
        required: true
        default: '48'
        type: string
      end_row:
        description: 'End Row Number (1-based)'
        required: true
        default: '53'
        type: string

jobs:
  generate-pdfs:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
    
    - name: Set up Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.10'
    
    - name: Upgrade pip and install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install --upgrade setuptools wheel
        pip install pandas fpdf2 requests typing-extensions
    
    - name: Create PDFs directory
      run: mkdir -p pdfs
    
    - name: Generate PDFs from CSV
      run: |
        python scripts/generate_pdfs.py \
          --csv-url "${{ github.event.inputs.csv_url }}" \
          --output-dir pdfs \
          --start-row ${{ github.event.inputs.start_row }} \
          --end-row ${{ github.event.inputs.end_row }}
    
    - name: Create ZIP file
      run: |
        cd pdfs
        zip -r ../pdfs_rows_${{ github.event.inputs.start_row }}_to_${{ github.event.inputs.end_row }}.zip *.pdf summary.txt
        cd ..
    
    - name: Upload PDFs as Artifacts
      uses: actions/upload-artifact@v4
      with:
        name: pdfs-rows-${{ github.event.inputs.start_row }}-to-${{ github.event.inputs.end_row }}
        path: pdfs/
        retention-days: 30
    
    - name: Upload ZIP as Artifact
      uses: actions/upload-artifact@v4
      with:
        name: pdfs-zip-rows-${{ github.event.inputs.start_row }}-to-${{ github.event.inputs.end_row }}
        path: pdfs_*.zip
        retention-days: 30

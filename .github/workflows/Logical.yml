name: Generate PDFs Logical

on:
  workflow_dispatch:
    inputs:
      csv_url:
        description: 'CSV File URL'
        required: true
        default: 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTBuDewVgTDoc_zaWYQyaWKpBt0RwtFPhnBrpqr1v6Y5wfAmPpEYvTsaWd64bsHhH68iYNtLMSRpOQ0/pub?gid=113399134&single=true&output=csv'
        type: string
      start_row:
        description: 'Start Row Number (1-based)'
        required: true
        default: '48'
        type: string
      end_row:
        description: 'End Row Number (1-based) (leave empty for all rows)'
        required: false
        default: '53'
        type: string

jobs:
  generate-pdfs:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
    
    - name: Set up Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.10'
    
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install pandas fpdf2 requests typing-extensions
    
    - name: Create PDFs directory
      run: mkdir -p pdfs
    
    - name: Generate PDFs from CSV (Columns AW-BB only)
      run: |
        if [ -z "${{ github.event.inputs.end_row }}" ]; then
          python scripts/generate_pdfs.py \
            --csv-url "${{ github.event.inputs.csv_url }}" \
            --output-dir pdfs \
            --start-row ${{ github.event.inputs.start_row }}
        else
          python scripts/generate_pdfs.py \
            --csv-url "${{ github.event.inputs.csv_url }}" \
            --output-dir pdfs \
            --start-row ${{ github.event.inputs.start_row }} \
            --end-row ${{ github.event.inputs.end_row }}
        fi
    
    - name: Create single ZIP file of all PDFs
      run: |
        cd pdfs
        if [ -n "${{ github.event.inputs.end_row }}" ]; then
          zip -r ../pdfs_rows_${{ github.event.inputs.start_row }}_to_${{ github.event.inputs.end_row }}.zip *
        else
          zip -r ../pdfs_rows_${{ github.event.inputs.start_row }}_onwards.zip *
        fi
        cd ..
    
    - name: Upload single PDF artifact
      uses: actions/upload-artifact@v4
      with:
        name: generated-pdfs
        path: pdfs_*.zip
        retention-days: 30
        if-no-files-found: error
